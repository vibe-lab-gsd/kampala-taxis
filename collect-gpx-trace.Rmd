---
title: "Collecting a GPX trace"
output: 
  rmdformats::readthedown:
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#knitr::knit_engines$set(python = reticulate::eng_python) 
```


```{r, message=FALSE, results='hide', echo=FALSE, warning=FALSE}
library(here)
library(sf)
library(tidyverse)
library(ggspatial)
library(exifr)
```

This page demonstrates how to collect a GPX trace using the OsmAnd app on your 
phone.

OsmAnd ([iOS](https://apps.apple.com/us/app/osmand-maps-travel-navigate/id934850257) and [Android](https://play.google.com/store/apps/details?id=net.osmand&hl=en_US&gl=US)) is a navigation app build on OpenStreetMap that also
will record GPX traces if you enable the "Trip recording" plugin.

The demonstration below uses the OsmAnd app for iOS (with some examples from an Android
device when things look different).

# Initial setup

When you first install and open the app, you'll see a screen like this:

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0489.PNG") |>
  knitr::include_graphics()
```

The first screen will ask you to download a map that corresponds with your 
current location. This is to allow the app to work offline (without an 
internet connection). You can skip downloading the map and still record 
GPS locations, but the app won't show you a basemap in the background.

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0490.PNG") |>
  knitr::include_graphics()
```

If your phone asks apps not to track your location by default, the app might guess the wrong
map to download for your current location. In this case, you can tap "Skip Download" on the
bottom left corner of the screen.

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "image000000-ct.png") |>
  knitr::include_graphics()
```

Then you can search for the map you want to download.

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "image000000 (1).png") |>
  knitr::include_graphics()
```

Once you've downloaded a basemap, the download button becomes a "Go to the map"
button. Tap that button.

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0491.PNG") |>
  knitr::include_graphics()
```

You'll see a map of your current surroundings. On the botton right corner of the map, there
will be a little crosshair icon. If you tap that, you'll get a message asking you to give
the app permission to use your location. 

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "initial-map.jpeg") |>
  knitr::include_graphics()
```

Select the option to allow the app to record your location all the time, even when 
the app is closed. 

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0503.PNG") |>
  knitr::include_graphics()
```

Tap the little hamburger button on the bottom left corner of the map to open up the side menu. 

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0492.PNG") |>
  knitr::include_graphics()
```

Tap "My places". Select the "Tracks" icon on the bottom right and tap the banner that says,
"Please activate Track recording addon to record and save your tracks."

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0494.PNG") |>
  knitr::include_graphics()
```


You may need to add the Trip Recording plugin from the Plugin manager
(find it towards the bottom of the side menu, right before settings).

It will look like this:

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "image000000 (2).png") |>
  knitr::include_graphics()
```

Tap the box or icon by "Trip Recording." It will show you a message saying you've added the plugin. Click OK.

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0495.PNG") |>
  knitr::include_graphics()
```

Now the checkbox or icon will be highlighted in orange. 


# Start recording your GPS trace

Tap on "< My Places" and go to the "Tracks" tab. 

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0496.PNG") |>
  knitr::include_graphics()
```

You'll see a banner that says "New track" and a button that says "Start Recording".
Tap that button.

A dialog will pop up where you can 
adjust the recording interval. By default, it will record your location every five 
seconds. Change it to every one second to improve the
precision of your GPS trace.

Click OK.

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0497.PNG") |>
  knitr::include_graphics()
```

Now you should see stop and save icons. The app is currently recording your
location. 

Close the app and open the Survey CTO app to record passenger boardings and 
alightings throughout the trip.

# Stop recording

When your trip is finished, tap the stop icon, then tap the save icon.


```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "image000000.PNG") |>
  knitr::include_graphics()
```


Tap the "Rec" folder, and you'll see your track listed with a file name
indicating the current date and time.

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0499.PNG") |>
  knitr::include_graphics()
```


# Export GPS trace

Tap the name of your track and it will open in a map.

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "IMG_0500.PNG") |>
  knitr::include_graphics()
```

To share the file, click the "Options"
button on the bottom left corner of your screen.

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "image000000[1].png") |>
  knitr::include_graphics()
```

Then click the Share item on the side menu.

```{r, echo=FALSE, message=FALSE, out.width = '30%'}
here("screenshots",
     "image000000[2].png") |>
  knitr::include_graphics()
```

 Email the trace to... [fill in email address]
and include the following information.
